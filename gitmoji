#!/bin/bash

# gitmoji
# by Dominic Baggott
# https://github.com/evilstreak/gitmoji
# tweaked by math2001

function gitmoji {
    # check we're in a git repo (or bail)
    git status >/dev/null 2>&1
    [ $? -ne 0 ] && return 1

    # check the git repo has any commits
    git rev-list --all >/dev/null 2>&1
    [ $? -ne 0 ] && return 1

    # look through all known commits to find the most recent by us
    git_email=`git config --get user.email`
    last_commit=`git rev-list --all --author=$git_email --fixed-strings --format=%at | fgrep -v commit | sort | tail -1`

    # bail if we didn't find a commit
    [[ -z $last_commit ]] && return 1

    # work out how long ago it was and pick an emoji
    elapsed=$((`date +%s` - $last_commit))

    if [ $elapsed -lt 300 ]; then # 5 minutes
      echo -e 'ðŸ˜‡'
    elif [ $elapsed -lt 1800 ]; then # 30 minutes
      echo -e 'ðŸ˜„'
    elif [ $elapsed -lt 3600 ]; then # 1 hour
      echo -e 'ðŸ˜Š'
    elif [ $elapsed -lt 7200 ]; then # 2 hours
      echo -e 'ðŸ˜Œ'
    elif [ $elapsed -lt 21600 ]; then # 6 hours
      echo -e 'ðŸ˜”'
    elif [ $elapsed -lt 86400 ]; then # 1 day
      echo -e 'ðŸ˜ž'
    elif [ $elapsed -lt 604800 ]; then # 1 week
      echo -e 'ðŸ˜¢'
    else
      echo -e 'ðŸ˜¡'
    fi
}
